(function(){var e={sdkVersion:"1.0.2",sdkType:"mobile_web",installationTime:"",appDisplayName:appDisplayName,sequenceNumber:sequenceNumber};var j={deviceId:"",pixel:"",language:navigator.language};var a={};var n=null;var g=new Date().getTime();var f={level:null,time:null};var i={};var k=location.hostname;function p(s){return s.replace(/(^\s*)|(\s*$)/g,"")}var q={addEventListener:function(t,u,s){if(t.addEventListener){t.addEventListener(u,s,false)}else{if(t.attachEvent){t.attachEvent("on"+u,s)}else{t["on"+u]=s}}}};var m=[];function o(s){l.addLoginCache("logout")}q.addEventListener(window,"pagehide",o);q.addEventListener(window,"beforeunload",o);(function(s,u,t){if(typeof module!=="undefined"&&module.exports){module.exports=t()}else{if(typeof define==="function"&&define.amd){define(t)}else{u[s]=t()}}})("Fingerprint",i,function(){var s=function(t){var u,v;u=Array.prototype.forEach;v=Array.prototype.map;this.each=function(B,A,z){if(B===null){return}if(u&&B.forEach===u){B.forEach(A,z)}else{if(B.length===+B.length){for(var y=0,w=B.length;y<w;y++){if(A.call(z,B[y],y,B)==={}){return}}}else{for(var x in B){if(B.hasOwnProperty(x)){if(A.call(z,B[x],x,B)==={}){return}}}}}};this.map=function(z,y,x){var w=[];if(z==null){return w}if(v&&z.map===v){return z.map(y,x)}this.each(z,function(C,A,B){w[w.length]=y.call(x,C,A,B)});return w};if(typeof t=="object"){this.hasher=t.hasher;this.screen_resolution=t.screen_resolution;this.screen_orientation=t.screen_orientation;this.canvas=t.canvas;this.ie_activex=t.ie_activex}else{if(typeof t=="function"){this.hasher=t}}};s.prototype={get:function(){var u=[];u.push(navigator.userAgent);u.push(navigator.language);u.push(screen.colorDepth);if(this.screen_resolution){var t=this.getScreenResolution();if(typeof t!=="undefined"){u.push(this.getScreenResolution().join("x"))}}u.push(new Date().getTimezoneOffset());u.push(this.hasSessionStorage());u.push(this.hasLocalStorage());u.push(!!window.indexedDB);if(document.body){u.push(typeof(document.body.addBehavior))}else{u.push(typeof undefined)}u.push(typeof(window.openDatabase));u.push(navigator.cpuClass);u.push(navigator.platform);u.push(navigator.doNotTrack);u.push(this.getPluginsString());if(this.canvas&&this.isCanvasSupported()){u.push(this.getCanvasFingerprint())}if(this.hasher){return this.hasher(u.join("###"),31)}else{return this.murmurhash3_32_gc(u.join("###"),31)}},murmurhash3_32_gc:function(A,x){var B,C,z,t,w,u,y,v;B=A.length&3;C=A.length-B;z=x;w=3432918353;u=461845907;v=0;while(v<C){y=((A.charCodeAt(v)&255))|((A.charCodeAt(++v)&255)<<8)|((A.charCodeAt(++v)&255)<<16)|((A.charCodeAt(++v)&255)<<24);++v;y=((((y&65535)*w)+((((y>>>16)*w)&65535)<<16)))&4294967295;y=(y<<15)|(y>>>17);y=((((y&65535)*u)+((((y>>>16)*u)&65535)<<16)))&4294967295;z^=y;z=(z<<13)|(z>>>19);t=((((z&65535)*5)+((((z>>>16)*5)&65535)<<16)))&4294967295;z=(((t&65535)+27492)+((((t>>>16)+58964)&65535)<<16))}y=0;switch(B){case 3:y^=(A.charCodeAt(v+2)&255)<<16;case 2:y^=(A.charCodeAt(v+1)&255)<<8;case 1:y^=(A.charCodeAt(v)&255);y=(((y&65535)*w)+((((y>>>16)*w)&65535)<<16))&4294967295;y=(y<<15)|(y>>>17);y=(((y&65535)*u)+((((y>>>16)*u)&65535)<<16))&4294967295;z^=y}z^=A.length;z^=z>>>16;z=(((z&65535)*2246822507)+((((z>>>16)*2246822507)&65535)<<16))&4294967295;z^=z>>>13;z=((((z&65535)*3266489909)+((((z>>>16)*3266489909)&65535)<<16)))&4294967295;z^=z>>>16;return z>>>0},hasLocalStorage:function(){try{return !!window.localStorage}catch(t){return true}},hasSessionStorage:function(){try{return !!window.sessionStorage}catch(t){return true}},isCanvasSupported:function(){var t=document.createElement("canvas");return !!(t.getContext&&t.getContext("2d"))},isIE:function(){if(navigator.appName==="Microsoft Internet Explorer"){return true}else{if(navigator.appName==="Netscape"&&/Trident/.test(navigator.userAgent)){return true}}return false},getPluginsString:function(){if(this.isIE()&&this.ie_activex){return this.getIEPluginsString()}else{return this.getRegularPluginsString()}},getRegularPluginsString:function(){return this.map(navigator.plugins,function(u){var t=this.map(u,function(v){return[v.type,v.suffixes].join("~")}).join(",");return[u.name,u.description,t].join("::")},this).join(";")},getIEPluginsString:function(){if(window.ActiveXObject){var t=["ShockwaveFlash.ShockwaveFlash","AcroPDF.PDF","PDF.PdfCtrl","QuickTime.QuickTime","rmocx.RealPlayer G2 Control","rmocx.RealPlayer G2 Control.1","RealPlayer.RealPlayer(tm) ActiveX Control (32-bit)","RealVideo.RealVideo(tm) ActiveX Control (32-bit)","RealPlayer","SWCtl.SWCtl","WMPlayer.OCX","AgControl.AgControl","Skype.Detection"];return this.map(t,function(u){try{new ActiveXObject(u);return u}catch(v){return null}}).join(";")}else{return""}},getScreenResolution:function(){var t;if(this.screen_orientation){t=(screen.height>screen.width)?[screen.height,screen.width]:[screen.width,screen.height]}else{t=[screen.height,screen.width]}return t},getCanvasFingerprint:function(){var v=document.createElement("canvas");var u=v.getContext("2d");var t="https://www.talkingdata.com";
u.textBaseline="top";u.font="14px 'Arial'";u.textBaseline="alphabetic";u.fillStyle="#f60";u.fillRect(125,1,62,20);u.fillStyle="#069";u.fillText(t,2,15);u.fillStyle="rgba(102, 204, 0, 0.7)";u.fillText(t,4,17);return v.toDataURL()}};return s});var r=function(t,A,D){if(typeof A!="undefined"){D=D||{};if(A===null){A="";D.expires=-1}var w="";if(D.expires&&(typeof D.expires=="number"||D.expires.toUTCString)){var x;if(typeof D.expires=="number"){x=new Date();x.setTime(x.getTime()+(D.expires*24*60*60*1000))}else{x=D.expires}w="; expires="+x.toUTCString()}var C=D.path?"; path="+(D.path):"";var y=D.domain?"; domain="+(D.domain):"";var s=D.secure?"; secure":"";document.cookie=[t,"=",encodeURIComponent(A),w,C,y,s].join("")}else{var v=null;if(document.cookie&&document.cookie!=""){var B=document.cookie.split(";");for(var z=0;z<B.length;z++){var u=p(B[z]);if(u.substring(0,t.length+1)==(t+"=")){v=decodeURIComponent(u.substring(t.length+1));break}}}return v}};i.localStorage={add:function(t,s){this.addLocalStorage(t,s);if(t!="sessionId"){this.addCookie(t,s)}},get:function(t){var s=this.getLocalStorage(t);if(!!s){return s}return this._getCookie(t)},create:function(){if(!!r("__TD_LOCAL")){return}this._addCookie("");if(!window.localStorage){return}},addCookie:function(w,u){if(window.localStorage){return}this.create();var v=this.cookieList();v[w]=u;var s=[];for(var t in v){s.push(t+"="+v[t])}this._addCookie(s.join(";"))},_setCookie:function(){var s=this.cookieList();r("__TD_LOCAL","",{expires:365*3,path:"/",domain:location.hostname})},_addCookie:function(s){r("__TD_LOCAL",s,{expires:365*3,path:"/",domain:location.hostname})},_getCookie:function(t){var s=this.cookieList();if(s&&s[t]){return s[t]}},delCookie:function(s){},cookieList:function(){var s=r("__TD_LOCAL");return this.format(s)},addLocalStorage:function(t,s){if(!window.localStorage){return}if(t=="sessionId"&&window.sessionStorage){sessionStorage.setItem("__TD_"+t,s)}else{localStorage["__TD_"+t]=s}},delLocalStorage:function(s){if(!window.localStorage){return}localStorage.removeItem("__TD_"+s)},getLocalStorage:function(s){if(!window.localStorage){return}if(s=="sessionId"&&window.sessionStorage){return sessionStorage.getItem("__TD_"+s)}else{return localStorage["__TD_"+s]}},format:function(u){var v={};if(!u){return v}var x=u.split(";");var s=x.length;for(var w=0;w<s;w++){var t=x[w].split("=");if(t.length!=2){continue}v[t[0]]=t[1]}return v}};i.sessionStorage={add:function(t,s){if(!window.sessionStorage){return}sessionStorage.setItem("__TD_"+t,s)},get:function(s){return sessionStorage.getItem("__TD_"+s)},remove:function(s){sessionStorage.removeItem("__TD_"+s)}};function h(){this.element=null;this.url=DTGARequestUrl;this.create();this.opts={}}h.prototype={create:function(){},scriptCallback:function(s){},set:function(s){this.opts=s;this.send()},getConfig:function(){},send:function(){var s=window.XMLHttpRequest?new XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP");s.open("POST",this.url,true);s.setRequestHeader("Content-type","application/x-www-form-urlencoded");s.onreadystatechange=function(){if(s.readyState==4&&s.status==200){}};s.send(JSON.stringify(this.opts))}};var d=new h();d.create();var b={};b.userInfo={userID:0,gameServer:"",level:-1};b.index={"G3":"Login","G4":"Logout","G5":"Levelup","G7":"UpdateUserProfile","G9.1":"Charge","G9.2":"Charge","G15":"Reward"};b.getEventData=function(t){var s=b.index;if(b.index[t]){return b[b.index[t]].getData(t)}};b.getCommon=function(){var s={appProfile:e,deviceProfile:j,events:[]};return s};b.Login={getData:function(){var s={eventOccurTime:new Date().getTime(),eventData:{},eventID:"G3"};s.eventData=a;var t=b.getUserStateTime("logout");if(!!t){s.eventData.interval=t}return s}};b.Logout={getData:function(){var s={eventOccurTime:new Date().getTime(),eventData:{},eventID:"G4"};var t=n||a;if(t.gameSessionID){s.eventData.gameSessionID=t.gameSessionID}if(t.userID){s.eventData.userID=t.userID}if(t.level){s.eventData.level=t.level}s.eventData.gameSessionStart=g;var u=b.getUserStateTime("login");if(!!u){s.eventData.duration=u}return s}};b.getUserStateTime=function(u){if(m.length>0){for(var v=m.length-1;v>=0;v--){var s=m[v];if(s[1]==u){var t=s[2];return parseInt((new Date().getTime()-t)/1000);break}}}};b.Levelup={getData:function(){var s={eventOccurTime:new Date().getTime(),eventData:{},eventID:"G5"};var t=a||n;s.eventData.gameSessionID=t.gameSessionID||a.gameSessionID;if(t.userID){s.eventData.userID=t.userID}if(t.level){console.log(t);s.eventData.level=t.level}if(t.gameServer){s.eventData.gameServer=t.gameServer}if(f.level){s.eventData.preLevel=f.level}if(f.time){s.eventData.timeConsuming=parseInt((new Date().getTime()-f.time)/1000)}s.eventData.gameSessionStart=g;var u=l.Mission.getMission();if(u){s.eventData.mission=u}return s}};b.UpdateUserProfile={getData:function(){var s=b.Login.getData();s.eventID="G7";return s}};b.Charge={getData:function(v){var s={eventOccurTime:new Date().getTime(),eventData:{},eventID:"G9"};s.eventData=l.Charge.info;var u=l.Mission.getMission();
var t=a;if(t.gameSessionID){s.eventData.gameSessionID=t.gameSessionID}if(t.userID){s.eventData.userID=t.userID}if(t.level){s.eventData.level=t.level}if(t.gameServer){s.eventData.gameServer=t.gameServer}if(u){s.eventData.mission=u}return s}};b.Reward={getData:function(){var s={eventOccurTime:new Date().getTime(),eventData:{},eventID:"G15"};var t=a;if(t.gameSessionID){s.eventData.gameSessionID=t.gameSessionID}if(t.userID){s.eventData.userID=t.userID}if(t.level){s.eventData.level=t.level}if(t.gameServer){s.eventData.gameServer=t.gameServer}var u=l.Reward.info;if(u.virtualCurrencyAmount){s.eventData.virtualCurrencyAmount=u.virtualCurrencyAmount}if(u.reason){s.eventData.reason=u.reason}if(u.mission){s.eventData.mission=u.mission}return s}};b.Account=function(s,t){var u={};u.gameSessionId=sessionId};b.Account.prototype={getData:function(){}};b.formatOpts=function(s){var u={};for(var t in s){u["key"]=s[t]}};b.loginCache=function(){var s=a.userID||j.deviceId};var c=i.localStorage;var l={deviceId:0,sessionId:0,init:function(){this.setDeviceId();this.setSession();this.setInstallation();this.setPixel();this.setUser();this.setPartner();this.setLoginCache();this.lastLogout();this.addLoginCache("login")},setDeviceId:function(){if(c.get("deviceId")){this.deviceId=c.get("deviceId")}else{var t=new i.Fingerprint();var u=new i.Fingerprint({screen_resolution:true});var s=t.get()+""+u.get();if(parseInt(s)==NaN){this.deviceId=s}else{this.deviceId=parseInt(s).toString(16)}c.add("deviceId",this.deviceId)}j.deviceId=this.deviceId},setSession:function(){var u;var t=this.deviceId;var s=parseInt(t,16);u=this.deviceId+""+new Date().getTime();if(!i.sessionStorage.get("sessionId")){i.sessionStorage.add("sessionId",u)}else{u=i.sessionStorage.get("sessionId")}a.gameSessionID=this.sessionId=u},setInstallation:function(){var s=new Date().getTime();if(!c.get("installationTime")){c.add("installationTime",s);e.installationTime=s}else{e.installationTime=c.get("installationTime")}},setPixel:function(){var s=[window.screen.width,window.screen.height];if(window.devicePixelRatio){s.push(window.devicePixelRatio)}j.pixel=s.join("*")},setPartner:function(){var t=location.search;if(t.indexOf("td_channelid")>-1){var u=t.replace("?","").split("&");for(var s=0;s<u.length;s++){if(u[s].indexOf("td_channelid=")>-1){e.partner=u[s].replace("td_channelid=","")}}}},setLoginCache:function(){var s=c.get("login");if(!!s){m=JSON.parse(s)}},addLoginCache:function(s){var t=a.userID||j.deviceId;var u=[];u.push(t);u.push(s);u.push(new Date().getTime());u.push(a.gameSessionID);m.push(u);if(m.length>30){m=m.splice(1,m.length-1)}c.add("login",JSON.stringify(m))},setUser:function(){var t=c.get("userID");n=n||{};if(t){a.userID=t;n.userID=t}var s=c.get("gameServer");if(s){a.gameServer=n.gameServer=s}var u=c.get("level");if(u){a.level=n.level=u}},lastLogout:function(){if(!m){return}var B=m;var v=B.length;var z=[];var u=[];for(var w=v-1;w>=0;w--){if(B[w].length<3){continue}if(z.length==0&&B[w][1]=="logout"){z=B[w]}else{if(B[w][1]=="login"){if(B[w][3]==z[3]){u=B[w]}}}}var s;var y;if(u.length>0){s=u[2];y=parseInt((z[2]-s)/1000);var t={eventOccurTime:z[2],eventData:{},eventID:"G4"};t.eventData={gameSessionID:z[3],userID:z[0],level:a.level,gameServer:a.gameServer,gameSessionStart:s,duration:y};var A=b.getCommon();A.events.push(t);var x=new h();x.set(A)}}};l.EventBox={eventNames:[],timer:null,add:function(t){var u=","+this.eventNames.join()+",";var v=t.split(",");for(var s=0;s<v.length;s++){if(u.indexOf(","+v[s])==-1){this.eventNames.push(v[s])}}this.send()},send:function(){var s=this;clearTimeout(s.timer);s.timer=setTimeout(function(){var y=","+s.eventNames.join()+",";if(y.indexOf("G3,")>-1){var t=[];for(var v=0;v<s.eventNames.length;v++){if(s.eventNames[v]!="G7"&&s.eventNames[v]!="G5"){t.push(s.eventNames[v])}}s.eventNames=t}var w=b.getCommon();for(var v=0;v<s.eventNames.length;v++){var x=s.eventNames[v];if(b.index[x]){w.events.push(b[b.index[x]].getData(x))}}if(w.events.length==0){return}var u=new h();u.set(w);s.eventNames=[]},20)}};l.setUserInfo=function(s){var t=a;if(a.gameSessionID){s.gameSessionID=a.gameSessionID}if(t.userID){s.userID=t.userID}if(t.level){s.level=parseInt(t.level)}if(t.gameServer){s.gameServer=t.gameServer}return s};l.init();window["TDGA"]={};TDGA.onPageLeave=function(){l.EventBox.add("G4")};TDGA.getDeviceId=function(){return j.deviceId};l.Account={eventList:[],set:function(u){var s=this;for(var t in u){if(l.Account["set_"+t]&&u[t]){l.Account["set_"+t](u[t])}}},set_accountId:function(s){if(!a.userID){c.add("userID",s);a.userID=s;l.EventBox.add("G3")}else{if(a.userID==s){}else{i.sessionStorage.remove("sessionId");l.setSession();n.userID=a.userID;c.add("userID",s);l.EventBox.add("G4,G3");a.userID=s}}},set_accountType:function(s){if(a.accountType!=s){c.add("accountType",s);a.accountType=s;l.EventBox.add("G7")}},set_accountName:function(s){if(a.account!=s){c.add("account",s);a.account=s;l.EventBox.add("G7")}},set_level:function(s){if(a.level){n.level=a.level}if(a.level!=s){f.level=a.level;
c.get("level");var t=c.get("leveluptime");if(t){f.time=t}c.add("level",s);c.add("leveluptime",new Date().getTime());a.level=s;l.EventBox.add("G5")}},set_gender:function(s){if(a.sex!=s){c.add("sex",s);a.sex=s;l.EventBox.add("G7")}},set_age:function(s){if(a.age!=s){c.add("age",s);a.age=s;l.EventBox.add("G7")}},set_gameServer:function(s){if(a.gameServer){n.gameServer=a.gameServer}if(a.gameServer!=s){c.add("gameServer",s);a.gameServer=s;l.EventBox.add("G7")}}};TDGA.Account=l.Account.set;TDGA.Account.setAccount=l.Account.set_userID;TDGA.Account.setAccountType=l.Account.set_accountType;TDGA.Account.setAccountName=l.Account.set_accountName;TDGA.Account.setLevel=l.Account.set_level;TDGA.Account.setGender=l.Account.set_gender;TDGA.Account.setAge=l.Account.set_age;TDGA.Account.setGameServer=l.Account.set_gameServer;TDGA.AccountType={"ANONYMOUS":0,"REGISTERED":1,"SINA_WEIBO":2,"QQ":3,"TENCENT_WEIBO":4,"ND91":5};TDGA.Gender={"UNKNOWN":-1,"MALE":1,"FEMALE":2};l.Mission={info:{},MissionNum:{},list:{},selKey:"_key",begin:function(t){if(!t||t==""){return}var s={};s=l.setUserInfo(s);s.mission=t;s.status=1;l.Mission.add(s);l.Mission.send(s)},completed:function(s){if(!s||s==""){return}var w={mission:s};w=l.setUserInfo(w);w.mission=s;w.status=2;var v=l.Mission;var z=v.list[w.mission+"_"+w.userID];if(z&&z.length>0){var t=z.length;for(var x=t-1;x>=0;x--){if(z[x].status==1&&z[x].time){var u=z[x].time;console.log(z[x]);var y=parseInt((new Date().getTime()-u)/1000);w.timeConsuming=y;break}}}var v=l.Mission;v.add(w);v.send(w)},failed:function(t,u){if(!t||t==""){return}var s={mission:t};s=l.setUserInfo(s);s.mission=t;s.cause=u;s.status=3;var v=l.Mission;v.add(s);v.send(s)},init:function(){var t=c.get("mission");if(!t){return}var u=JSON.parse(t);this.list=u;var s=c.get("mission_Num");if(s){this.MissionNum=JSON.parse(s)}},add:function(s){s.time=new Date().getTime();if(!this.list[s.mission+"_"+s.userID]){this.list[s.mission+"_"+s.userID]=[]}this.list[s.mission+"_"+s.userID].push(s);c.add("mission",JSON.stringify(this.list))},send:function(v){var s={eventOccurTime:new Date().getTime(),eventData:{},eventID:"G6"};delete v.time;var t=v.userID;this.MissionNum["uid_"+t]=v.mission;c.add("mission_Num",JSON.stringify(this.MissionNum));s.eventData=v;var u=b.getCommon();u.events.push(s);var w=new h();w.set(u)},getMission:function(){var t=this.MissionNum;var s=a.userID;return t["uid_"+s]}};l.Mission.init();TDGA.onMissionBegin=l.Mission.begin;TDGA.onMissionCompleted=l.Mission.completed;TDGA.onMissionFailed=l.Mission.failed;l.Reward={info:{},send:function(t,v){l.Reward.info={};var s={};if(!!t){s.virtualCurrencyAmount=t}if(!!v){s.reason=v}var u=l.Mission.getMission();if(u){s.mission=u}l.Reward.info=s;l.EventBox.add("G15")}};TDGA.onReward=l.Reward.send;l.Item={purchase:function(s){if(!s||!s.item){return}var t={};t.itemid=s.item;if(s.itemNumber){t.itemnumber=parseInt(s.itemNumber)}if(s.priceInVirtualCurrency){t.virtualCurrencyAmount=parseFloat(s.priceInVirtualCurrency)}var u=l.Mission.getMission();if(u){t.mission=u}t=l.setUserInfo(t);l.Item.send(t,"G10")},use:function(s){if(!s||!s.item){return}var t={};t.itemid=s.item;if(s.itemNumber){t.itemnumber=s.itemNumber}var u=l.Mission.getMission();if(u){t.mission=u}t=l.setUserInfo(t);l.Item.send(t,"G12")},send:function(v,s){var t={eventOccurTime:new Date().getTime(),eventData:{},eventID:s};t.eventData=v;var u=b.getCommon();u.events.push(t);var w=new h();w.set(u)},};TDGA.onItemPurchase=l.Item.purchase;TDGA.onItemUse=l.Item.use;l.Charge={info:{},orderList:{},selKey:"_key",request:function(v){if(!v.orderId||v.orderId==""){return}var s=this;s.info={};var u=["orderId","iapId","currencyAmount","currencyType","virtualCurrencyAmount","paymentType"];for(var t=0;t<u.length;t++){if(v[u[t]]){s.info[u[t]]=v[u[t]]}}s.info["status"]=1;l.Charge.info=s.info;l.EventBox.add("G9.1")},successt:function(v){if(!v.orderId||v.orderId==""){return}var s=this;s.info={};var u=["orderId","iapId","currencyAmount","currencyType","virtualCurrencyAmount","paymentType"];for(var t=0;t<u.length;t++){if(v[u[t]]){s.info[u[t]]=v[u[t]]}}s.info["status"]=2;l.Charge.info=s.info;l.EventBox.add("G9.2")},init:function(){var t=c.get("order");if(!t||t=="undefined"){return}var s=JSON.parse(t);this.addOrder(s)},addOrder:function(s){this.orderList[s.orderId+this.selKey]=s}};l.Charge.init();TDGA.onChargeRequest=l.Charge.request;TDGA.onChargeSuccess=l.Charge.successt})();